setwd("C:/Users/Tyler Moulton/Documents/Dropbox backup March 2015/Honors 2012 mormyrids/data sheets/Signal analysis R/Data/pcritshts")
get.witrox.data <-
function(lines.skip, delimit="tab", choose.names = F,
chosen.names = NULL,
format = "%d/%m/%Y %I:%M:%S %p"){
if(delimit == "tab"){
separate = "\t"
}else if(delimit == "space"){
separate = ""
}else if(delimit == "comma"){
separate = ","
}
if(choose.names==F){
d<-read.table(file.choose(), sep=separate, skip=lines.skip,
header =T,check.names=F)
invalid.names<-colnames(d)
valid.names<-make.names(colnames(d))
var.names<-NULL
for(i in 1:length(invalid.names)){
if(invalid.names[i] == valid.names[i]){
var.names[i] <- valid.names[i]
}else{
split.name.period <- as.vector(
strsplit(valid.names[i], fixed = T,
split = ".")[[1]])
split.name.period <- paste(split.name.period, sep="",
collapse="")
split.name <- as.vector(
strsplit(split.name.period, fixed = F,
split = c("Â"))[[1]])
split.name <- paste(split.name, sep=".", collapse=".")
var.names[i] <-  as.vector(
strsplit(split.name, fixed = F,
split = c("â"))[[1]])
}
}
}else if(choose.names==T){
d<-read.table(file.choose(), sep = separate, skip = lines.skip,
header = F)
var.names<-chosen.names
}
colnames(d) <- var.names
d[,1]<-as.character(d[,1])
d$std.time <- as.POSIXct(strptime(d[,1], format = format),
origin = "1970-01-01 00:00:00 UTC")
return(d)
}
names.vec <- c("Date.time", "timestamp"," Bar.Pressure.hpa", "Phase",
"temp.C", "DO.mgL")
fishMR<-get.witrox.data(lines.skip = 10, choose.names = TRUE,
chosen.names = names.vec)
View(fishMR)
save(fishMR, "fishMR.rda")
save(fishMR, file= "fishMR.rda")
setwd("C:/Users/Tyler Moulton/Documents/rMR")
save(fishMR, file= "fishMR.rda")
setwd("C:/Users/Tyler Moulton/Documents/rMR/data")
save(fishMR, file= "fishMR.rda")
rm(fishMR)
load("~/rMR/data/fishMR.rda")
View(fishMR)
str(fishMR)
names.vec<-names.vec
dd<-get.witrox.data(lines.skip = 10, choose.names = TRUE,
chosen.names = names.vec)
str(fishMR)
dd<-get.witrox.data(lines.skip = 10, choose.names = TRUE,
chosen.names = names.vec)
get.witrox.data <-
function(data.name, lines.skip, delimit="tab", choose.names = F,
chosen.names = NULL,
format = "%d/%m/%Y %I:%M:%S %p"){
if(delimit == "tab"){
separate = "\t"
}else if(delimit == "space"){
separate = ""
}else if(delimit == "comma"){
separate = ","
}
if(choose.names==F){
d<-read.table(file.choose(), sep=separate, skip=lines.skip,
header =T,check.names=F)
invalid.names<-colnames(d)
valid.names<-make.names(colnames(d))
var.names<-NULL
for(i in 1:length(invalid.names)){
if(invalid.names[i] == valid.names[i]){
var.names[i] <- valid.names[i]
}else{
split.name.period <- as.vector(
strsplit(valid.names[i], fixed = T,
split = ".")[[1]])
split.name.period <- paste(split.name.period, sep="",
collapse="")
split.name <- as.vector(
strsplit(split.name.period, fixed = F,
split = c("Â"))[[1]])
split.name <- paste(split.name, sep=".", collapse=".")
var.names[i] <-  as.vector(
strsplit(split.name, fixed = F,
split = c("â"))[[1]])
}
}
}else if(choose.names==T){
d<-read.table(data.name, sep = separate, skip = lines.skip,
header = F)
var.names<-chosen.names
}
colnames(d) <- var.names
d[,1]<-as.character(d[,1])
d$std.time <- as.POSIXct(strptime(d[,1], format = format),
origin = "1970-01-01 00:00:00 UTC")
return(d)
}
dd<-get.witrox.data(data.name = "fish.MR.txt", lines.skip = 10, choose.names = TRUE,
chosen.names = names.vec)
ddd<-get.witrox.data(data.name = "fish.MR.txt", lines.skip = 10, choose.names = TRUE,
chosen.names = names.vec)
install.packages("roxygen2")
library(roxygen2)
names.vec<-data(names.vec)
setwd("C:/Users/Tyler Moulton/Documents/rMR")
names.vec<-data(names.vec)
d<-get.witrox.data(data.name = "fish.MR.txt", lines.skip = 10, choose.names = TRUE, chosen.names = names.vec)
setwd("C:/Users/Tyler Moulton/Documents/rMR/data")
names.vec<-data(names.vec)
names.vec<-data("names.vec.rda")
getwd()
names.vec<-data(names.vec.rda)
names.vec<-data(fishMR.rda)
rm(list=ls())
library(rMR)
library(rMR)
Pcrit1 <-get.pcrit(data = d, DO = "DO.mgL", Pcrit.below = 2,
idx.interval = 120,
start.idx = "2015-07-03 06:15:00",
stop.idx = "2015-07-03 08:05:00")
data(fishMR)
Pcrit1 <-get.pcrit(data = fishMR, DO = "DO.mgL", Pcrit.below = 2,
idx.interval = 120,
start.idx = "2015-07-03 06:15:00",
stop.idx = "2015-07-03 08:05:00")
library(rMR)
data(fishMR)
Pcrit1 <-get.pcrit(data = fishMR, DO = "DO.mgL",
Pcrit.below = 2,
idx.interval = 120,
start.idx = "2015-07-03 06:15:00",
stop.idx = "2015-07-03 08:05:00")
## Change time interval ##
Pcrit2 <-get.pcrit(data = fishMR, DO = "DO.mgL",
Pcrit.below = 2,
idx.interval = 60,
start.idx = "2015-07-03 06:15:00",
stop.idx = "2015-07-03 08:05:00")
Pcrit1$Pcrit
Pcrit2$Pcrit
data(fishMR)
plot.raw(data = fishMR, DO.var.name = "DO.mgL",
start.time = "2015-07-03 06:15:00",
end.time = "2015-07-03 08:05:00")
plot.raw(fishMR, DO.var.name = "DO.mgL",
start.time = "2015-07-03 01:00:00",
end.time = "2015-07-03 05:12:00")
head(fishMR)
DO.pct.col<- DO.unit.convert(fishMR$DO.mgL, DO.units.in = "mg/L",
DO.units.out = "pct",
bar.units.in = "kpa", bar.press = 101.3,
temp.C = fishMR$temp.C,
bar.units.out = "mmHg")
DO.pct.col <- DO.unit.convert(fishMR$DO.mgL, DO.units.in = "mg/L",
DO.units.out = "pct",
bar.units.in = "kpa", bar.press = 101.3,
temp.C = fishMR$temp.C,
bar.units.out = NULL)
DO.pct.col <- DO.unit.convert(fishMR$DO.mgL, DO.units.in = "mg/L",
DO.units.out = "pct",
bar.units.in = "kpa", bar.press = 101.3,
temp.C = fishMR$temp.C,
bar.units.out = "kpa")
par(mfrow = c(1,2))
plot.raw(data = fishMR, DO.var.name = "DO.mgL",
start.time = "2015-07-03 06:15:00",
end.time = "2015-07-03 08:05:00",
main = "DO (mg/L) vs time",
xlab = "time",
ylab = "DO (mg/L)")
plot.raw <-
function(data, DO.var.name, time.var.name = "std.time",
start.time = data$x[1],
end.time = data$x[length(data$x)], ...){
orig = "1970-01-01 00:00:00 UTC"
data$x <- eval(parse(text = paste("data$", time.var.name, sep = "")))
data <- data[data$x >= start.time & data$x <= end.time,]
data$y <- eval(parse(text = paste("data$", DO.var.name, sep = "")))
plot(y~std.time, data, ...)
}
par(mfrow = c(1,2))
plot.raw(data = fishMR, DO.var.name = "DO.mgL",
start.time = "2015-07-03 06:15:00",
end.time = "2015-07-03 08:05:00",
main = "DO (mg/L) vs time",
xlab = "time",
ylab = "DO (mg/L)")
plot.raw(data = fishMR2, DO.var.name = "DO.pct.col",
start.time = "2015-07-03 06:15:00",
end.time = "2015-07-03 08:05:00",
main = "DO (\% saturation) vs time",
xlab = "time",
ylab = "DO (\%saturation)")
plot.raw(data = fishMR2, DO.var.name = "DO.pct.col",
start.time = "2015-07-03 06:15:00",
end.time = "2015-07-03 08:05:00",
main = "DO (percent saturation) vs time",
xlab = "time",
ylab = "DO (percent saturation)")
fishMR2 <- cbind(fishMR, DO.pct.col)
plot.raw(data = fishMR2, DO.var.name = "DO.pct.col",
start.time = "2015-07-03 06:15:00",
end.time = "2015-07-03 08:05:00",
main = "DO (percent saturation) vs time",
xlab = "time",
ylab = "DO (percent saturation)")
library(rMR)
library(biglm)
library(rMR)
library(rMR)
data(fishMR)
## set vectors of time indices for resp loops##
starts <- c("2015-07-03 01:22:00", "2015-07-03 02:13:00",
"2015-07-03 03:02:00", "2015-07-03 03:50:00",
"2015-07-03 04:50:00")
stops <- c("2015-07-03 01:44:00", "2015-07-03 02:35:30",
"2015-07-03 03:25:00", "2015-07-03 04:16:00",
"2015-07-03 05:12:00")
metR <- MR.loops(data = fishMR, DO.var.name ="DO.mgL",
start.idx = starts,
stop.idx = stops, time.var.name = "std.time",
temp.C = "temp.C", elevation.m = 1180,
bar.press = NULL, in.DO.meas = "mg/L",
background.start = "2015-07-02 16:05:00",
background.end = "2015-07-02 16:35:00",
ylim=c(6,8))
## view output summary ##
metR$MR.summary
mean(metR$MR.summary$Mr.mg.sec)
mean(metR$MR.summary$MR.mg.sec)
?get.pcrit
data(fishMR)
Pcrit1 <-get.pcrit(data = fishMR, DO = "DO.mgL",
Pcrit.below = 2,
idx.interval = 120,
start.idx = "2015-07-03 06:15:00",
stop.idx = "2015-07-03 08:05:00")
## Change time interval ##
Pcrit2 <-get.pcrit(data = fishMR, DO = "DO.mgL",
Pcrit.below = 2,
idx.interval = 60,
start.idx = "2015-07-03 06:15:00",
stop.idx = "2015-07-03 08:05:00")
Pcrit1$Pcrit
Pcrit2$Pcrit
DO.pct<- DO.unit.convert(x= 125.6863, DO.units.in = "PP",
DO.units.out = "pct",
bar.units.in = "mmHg", bar.press = 750, temp.C =15,
bar.units.out = "mmHg")
## Apply to a column in a 'data.frame' class object ##
## load data ##
data(fishMR)
head(fishMR)
#note that DO data are in mg/L (DO.mgL) and
#that there is an instantaneous temperature column
#(temp.C) and a pressure column (Bar.Pressure.hpa)
DO.pct.col <- DO.unit.convert(fishMR$DO.mgL, DO.units.in = "mg/L",
DO.units.out = "pct",
bar.units.in = "kpa", bar.press = 101.3,
temp.C = fishMR$temp.C,
bar.units.out = "kpa")
fishMR2 <- cbind(fishMR, DO.pct.col)
par(mfrow = c(1,2))
plot.raw(data = fishMR, DO.var.name = "DO.mgL",
start.time = "2015-07-03 06:15:00",
end.time = "2015-07-03 08:05:00",
main = "DO (mg/L) vs time",
xlab = "time",
ylab = "DO (mg/L)")
plot.raw(data = fishMR2, DO.var.name = "DO.pct.col",
start.time = "2015-07-03 06:15:00",
end.time = "2015-07-03 08:05:00",
main = "DO (percent saturation) vs time",
xlab = "time",
ylab = "DO (percent saturation)")
DO.pct
rm(list=ls())
library(roxygen2)
#'@importFrom biglm biglm
warnings()
library(rMR)
library(rMR)
library(rMR)
library(rMR)
data(fishMR)
## set vectors of time indices for resp loops##
starts <- c("2015-07-03 01:22:00", "2015-07-03 02:13:00",
"2015-07-03 03:02:00", "2015-07-03 03:50:00",
"2015-07-03 04:50:00")
stops <- c("2015-07-03 01:44:00", "2015-07-03 02:35:30",
"2015-07-03 03:25:00", "2015-07-03 04:16:00",
"2015-07-03 05:12:00")
metR <- MR.loops(data = fishMR, DO.var.name ="DO.mgL",
start.idx = starts,
stop.idx = stops, time.var.name = "std.time",
temp.C = "temp.C", elevation.m = 1180,
bar.press = NULL, in.DO.meas = "mg/L",
background.start = "2015-07-02 16:05:00",
background.end = "2015-07-02 16:35:00",
ylim=c(6,8))
## view output summary ##
metR$MR.summary
## This looks great, but you need to check your start and
## stop vectors, otherwise, you could end up with some
## atrocious loops, e.g.:
starts <- c("2015-07-03 01:15:00", "2015-07-03 02:13:00",
"2015-07-03 03:02:00", "2015-07-03 03:50:00",
"2015-07-03 04:50:00")
stops <- c("2015-07-03 01:50:00", "2015-07-03 02:35:30",
"2015-07-03 03:25:00", "2015-07-03 04:16:00",
"2015-07-03 05:12:00")
metR <- MR.loops(data = fishMR, DO.var.name ="DO.mgL",
start.idx = starts,
stop.idx = stops, time.var.name = "std.time",
temp.C = "temp.C", elevation.m = 1180,
bar.press = NULL, in.DO.meas = "mg/L",
background.start = "2015-07-02 16:05:00",
background.end = "2015-07-02 16:35:00",
ylim=c(6,8))
install.packages("Rtools")
